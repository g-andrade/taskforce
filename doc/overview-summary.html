<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>taskforce</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css" title="EDoc">
</head>
<body bgcolor="white">
<div class="navbar"><a name="#navbar_top"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<h1>taskforce</h1>
<p>Copyright Â© 2015 Guilherme Andrade</p>
<p><b>Version:</b> 1.2.0</p>
<p><b>Authors:</b> Guilherme Andrade (<a href="mailto:g@gandrade.net"><tt>g@gandrade.net</tt></a>).</p>
<p><code>taskforce</code> allows you to parallelise arbitrary tasks in a controlled way.</p>

<hr>

<h3><a name="Creating_tasks">Creating tasks</a></h3>
<pre lang="erlang">
Tasks = #{ some_task =&gt; taskforce:task(function work/0, Args, #{ timeout =&gt; 2000 }),
           similar_task =&gt; taskforce:task(function work/0, Args123, #{ timeout =&gt; 2500 }),
           other_task =&gt; taskforce:task(function other_work/0, OtherArgs, #{ timeout =&gt; 500 }) }.
</pre>

<h3><a name="Executing_tasks">Executing tasks</a></h3>
<pre lang="erlang">
#{ completed := Completed } = taskforce:execute(Tasks),
SomeTaskResult = maps:get(some_task, Completed),
SimilarTaskResult = maps:get(similar_task, Completed),
OtherTaskResult = maps:get(other_task, Completed).
</pre>

<h3><a name="Finely_tuning_execution">Finely tuning execution</a></h3>
<pre lang="erlang">
ExecutionOptions = #{ max_workers =&gt; 8, timeout =&gt; 5000 },
#{ completed := Completed } = taskforce:execute(Tasks, ExecutionOptions),
% ...
</pre>

<h3><a name="Individual_task_timeouts">Individual task timeouts</a></h3>
<pre lang="erlang">
% ...
#{ individual_timeouts := IndividualTimeouts } = taskforce:execute(Tasks),
(length(IndividualTimeouts) &gt; 0
 andalso io:format("oh noes! tasks with ids ~p timed-out",
                   [IndividualTimeouts]))
</pre>

<h3><a name="Global_execution_timeouts">Global execution timeouts</a></h3>
<pre lang="erlang">
% ...
#{ global_timeouts := GlobalTimeouts } = taskforce:execute(Tasks),
(length(GlobalTimeouts) &gt; 0
 andalso io:format("execution ran out of time; tasks with ids ~p timed-out",
                   [GlobalTimeouts]))
</pre>

<h3><a name="Full_example">Full example</a></h3>
<pre lang="erlang">
%
% Calculate first 200 prime numbers using 4 processes,
% with a timeout of 2s per individual calculation and 10s
% for the whole batch.
%
NrOfPrimes = 200,
Tasks =
    maps:from_list(
        [{Nth, taskforce:task(fun fancy_lib:find_nth_prime/1,
                              [Nth], #{ timeout =&gt; 2000 })}
         || Nth &lt;- lists:seq(1, NrOfPrimes)]),

ExecutionOptions =
    #{ % default is the sum of all individual task timeouts
       timeout =&gt; 10000,

       % default is number of active schedulers
       max_workers =&gt; 4 },

#{ completed := NthPrimes } = taskforce:execute(Tasks, ExecutionOptions),
io:format("200th prime is: ~p~n", [maps:get(200, NthPrimes)]).
</pre>

Also in <code>examples/</code>.

<hr>
<div class="navbar"><a name="#navbar_bottom"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<p><i>Generated by EDoc, Apr 30 2017, 22:57:24.</i></p>
</body>
</html>
