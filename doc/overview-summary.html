<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>taskforce</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css" title="EDoc">
</head>
<body bgcolor="white">
<div class="navbar"><a name="#navbar_top"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<h1>taskforce</h1>
<p>Copyright Â© 2015 Guilherme Andrade</p>
<p><b>Version:</b> 1.0.0</p>
<p><b>Authors:</b> Guilherme Andrade (<a href="mailto:g@gandrade.net"><tt>g@gandrade.net</tt></a>).</p>
<p><code>taskforce</code> allows you to parallelise arbitrary tasks in a controlled way.</p>

<hr>
<pre lang="erlang">
application:ensure_all_started(taskforce),
application:ensure_all_started(inets),
application:ensure_all_started(ssl),

DownloadFun = fun(Id, Url) -&gt;
    io:format("~p Trying to download '~p' @ ~p..~n", [os:timestamp(), Id, Url]),
    {ok, Result} = httpc:request(Url),
    io:format("~p Handled '~p'~n", [os:timestamp(), Id]),
    Result
end,

IdentifiedUrls = [{google_homepage, "https://www.google.com/"},
                  {ip_over_avian_carriers_rfc, "https://www.ietf.org/rfc/rfc1149.txt"},
                  {hackernews_rss, "https://news.ycombinator.com/rss"},
                  {example_image1, "https://assets.crowdsurge.com/datacapture/example/img/example_logo.png"},
                  {example_image2, "http://underthebridge.co.uk/wp-content/uploads/2014/03/Example-main-image1.jpg"},
                  {example_image3, "https://assets-cdn.github.com/images/modules/logos_page/GitHub-Mark.png"}],


IndividualTimeoutT = 2000, % in miliseconds
GlobalTimeoutT = 10000,    % in miliseconds
MinionCount = 4,          % 4 workers

Tasks = [taskforce:new_task({download_result, Id}, DownloadFun, [Id, Url], IndividualTimeoutT)
         || {Id, Url} &lt;- IdentifiedUrls],

{ResultsById, Individualtimeouts, GlobalTimeouts} = taskforce:execute_tasks(
      Tasks, GlobalTimeoutT, MinionCount).

% {1430,311507,997903} Trying to download 'example_image2' @ "http://underthebridge.co.uk/wp-content/uploads/2014/03/Example-main-image1.jpg"..
% {1430,311507,997915} Trying to download 'hackernews_rss' @ "https://news.ycombinator.com/rss"..
% {1430,311507,997925} Trying to download 'example_image3' @ "https://assets-cdn.github.com/images/modules/logos_page/GitHub-Mark.png"..
% {1430,311507,997936} Trying to download 'example_image1' @ "https://assets.crowdsurge.com/datacapture/example/img/example_logo.png"..
% {1430,311508,446044} Handled 'example_image2'
% {1430,311508,448227} Trying to download 'ip_over_avian_carriers_rfc' @ "https://www.ietf.org/rfc/rfc1149.txt"..
% {1430,311508,462708} Handled 'hackernews_rss'
% {1430,311508,463315} Trying to download 'google_homepage' @ "https://www.google.com/"..
% {1430,311508,771638} Handled 'example_image1'
% {1430,311508,810445} Handled 'google_homepage'
% {1430,311509,58815} Handled 'example_image3'
% {1430,311509,447087} Handled 'ip_over_avian_carriers_rfc'


lists:keyfind({download_result, hackernews_rss}, 1, ResultsById).
% {{download_result,hackernews_rss},
%  {{"HTTP/1.1",200,"OK"},
%   [{"cache-control","private"},
%    {"connection","keep-alive"},
%    {"date","Wed, 29 Apr 2015 12:45:08 GMT"},
%    {"server","cloudflare-nginx"},
%    {"content-length","10170"},
%    {"content-type","application/rss+xml; charset=utf-8"},
%    {"set-cookie",
%     "__cfduid=dfee6cd1ba6238c5dbf33583317f1448b1430311508; expires=Thu, 28-Apr-16 12:45:08 GMT; path=/; domain=.ycombinator.com; HttpOnly"},
%    {"x-frame-options","DENY"},
%    {"strict-transport-security",
%     "max-age=31556900; includeSubDomains"},
%    {"cf-ray","1deb1a2eba8b0ded-MAD"}],
%   [60,114,115,115,32,118,101,114,115,105,111,110,61,34,50,46,
%    48,34,62,60,99,104,97,110|...]}}
</pre>

<hr>
<div class="navbar"><a name="#navbar_bottom"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<p><i>Generated by EDoc, Apr 29 2015, 13:56:48.</i></p>
</body>
</html>
